apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.16.5
  labels:
    app.kubernetes.io/component: kratix-manager
    app.kubernetes.io/instance: kratix-platform
    app.kubernetes.io/part-of: kratix
  name: bucketstatestores.platform.kratix.io
spec:
  group: platform.kratix.io
  names:
    categories:
      - kratix
    kind: BucketStateStore
    listKind: BucketStateStoreList
    plural: bucketstatestores
    singular: bucketstatestore
  scope: Cluster
  versions:
    - additionalPrinterColumns:
        - description: Indicates the state store is ready to use
          jsonPath: .status.conditions[?(@.type=="Ready")].status
          name: Ready
          type: string
      name: v1alpha1
      schema:
        openAPIV3Schema:
          description: BucketStateStore is the Schema for the bucketstatestores API
          properties:
            apiVersion:
              description: |-
                APIVersion defines the versioned schema of this representation of an object.
                Servers should convert recognized schemas to the latest internal value, and
                may reject unrecognized values.
                More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
              type: string
            kind:
              description: |-
                Kind is a string value representing the REST resource this object represents.
                Servers may infer this from the endpoint the client submits requests to.
                Cannot be updated.
                In CamelCase.
                More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
              type: string
            metadata:
              type: object
            spec:
              description: BucketStateStoreSpec defines the desired state of BucketStateStore
              properties:
                authMethod:
                  default: accessKey
                  description: |-
                    Authentication method used to access the StateStore.
                    Default to accessKey; options are accessKey and IAM.
                  enum:
                    - accessKey
                    - IAM
                  type: string
                bucketName:
                  description: Name of the bucket; required field.
                  type: string
                endpoint:
                  description: |-
                    Endpoint to access the bucket.
                    Required field.
                  type: string
                insecure:
                  description: Toggle to turn off or on SSL verification when connecting to the bucket.
                  type: boolean
                path:
                  description: |-
                    Path within the StateStore to write documents. This path should be allocated
                    to Kratix as it will create, update, and delete files within this path.
                    Path structure begins with provided path and ends with namespaced destination name:
                      <StateStore.Spec.Path>/<Destination.Spec.Path>/<Destination.Metadata.Namespace>/<Destination.Metadata.Name>/
                  type: string
                secretRef:
                  description: SecretRef specifies the Secret containing authentication credentials
                  properties:
                    name:
                      description: name is unique within a namespace to reference a secret resource.
                      type: string
                    namespace:
                      description: namespace defines the space within which the secret name must be unique.
                      type: string
                  type: object
                  x-kubernetes-map-type: atomic
              required:
                - bucketName
                - endpoint
              type: object
            status:
              description: StateStoreStatus defines the observed state of a state store
              properties:
                conditions:
                  description: Current conditions of the StateStore. Includes a Ready condition indicating whether Kratix can access the store
                  items:
                    description: Condition contains details for one aspect of the current state of this API Resource.
                    properties:
                      lastTransitionTime:
                        description: |-
                          lastTransitionTime is the last time the condition transitioned from one status to another.
                          This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                        format: date-time
                        type: string
                      message:
                        description: |-
                          message is a human readable message indicating details about the transition.
                          This may be an empty string.
                        maxLength: 32768
                        type: string
                      observedGeneration:
                        description: |-
                          observedGeneration represents the .metadata.generation that the condition was set based upon.
                          For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                          with respect to the current state of the instance.
                        format: int64
                        minimum: 0
                        type: integer
                      reason:
                        description: |-
                          reason contains a programmatic identifier indicating the reason for the condition's last transition.
                          Producers of specific condition types may define expected values and meanings for this field,
                          and whether the values are considered a guaranteed API.
                          The value should be a CamelCase string.
                          This field may not be empty.
                        maxLength: 1024
                        minLength: 1
                        pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                        type: string
                      status:
                        description: status of the condition, one of True, False, Unknown.
                        enum:
                          - "True"
                          - "False"
                          - Unknown
                        type: string
                      type:
                        description: type of condition in CamelCase or in foo.example.com/CamelCase.
                        maxLength: 316
                        pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                        type: string
                    required:
                      - lastTransitionTime
                      - message
                      - reason
                      - status
                      - type
                    type: object
                  type: array
                status:
                  description: Overall status of the StateStore
                  type: string
              required:
                - status
              type: object
          type: object
      served: true
      storage: true
      subresources:
        status: {}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.16.5
  labels:
    app.kubernetes.io/component: kratix-manager
    app.kubernetes.io/instance: kratix-platform
    app.kubernetes.io/part-of: kratix
  name: destinations.platform.kratix.io
spec:
  group: platform.kratix.io
  names:
    categories:
      - kratix
    kind: Destination
    listKind: DestinationList
    plural: destinations
    shortNames:
      - dest
      - dests
    singular: destination
  scope: Cluster
  versions:
    - additionalPrinterColumns:
        - description: State store kind.
          jsonPath: .spec.stateStoreRef.kind
          name: StateStoreKind
          type: string
        - description: State store name.
          jsonPath: .spec.stateStoreRef.name
          name: StateStoreName
          type: string
        - description: Indicates the destination is ready to use.
          jsonPath: .status.conditions[?(@.type=="Ready")].status
          name: Ready
          type: string
      name: v1alpha1
      schema:
        openAPIV3Schema:
          description: Destination is the Schema for the Destinations API
          properties:
            apiVersion:
              description: |-
                APIVersion defines the versioned schema of this representation of an object.
                Servers should convert recognized schemas to the latest internal value, and
                may reject unrecognized values.
                More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
              type: string
            kind:
              description: |-
                Kind is a string value representing the REST resource this object represents.
                Servers may infer this from the endpoint the client submits requests to.
                Cannot be updated.
                In CamelCase.
                More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
              type: string
            metadata:
              type: object
            spec:
              description: DestinationSpec defines the desired state of Destination.
              properties:
                cleanup:
                  default: none
                  description: |-
                    cleanup can be set to either:
                    - none (default): no cleanup after removing the destination
                    - all: workplacements and statestore contents will be removed after removing the destination
                  enum:
                    - none
                    - all
                  type: string
                filepath:
                  default:
                    mode: nestedByMetadata
                  description: The filepath mode to use when writing files to the destination.
                  properties:
                    filename:
                      description: |-
                        If filepath.mode is set to aggregatedYAML, this field can be set to
                        specify the filename of the aggregated YAML file.  Defaults to
                        "aggregated.yaml"
                      type: string
                    mode:
                      description: |-
                        filepath.mode can be set to either:
                        - nestedByMetadata (default): files from the pipeline will be placed in a nested directory structure
                        - aggregatedYAML: all files from all pipelines will be aggregated into a single YAML file
                        - none: file from the pipeline will be placed in a flat directory structure
                        filepath.mode is immutable
                      enum:
                        - nestedByMetadata
                        - aggregatedYAML
                        - none
                      type: string
                      x-kubernetes-validations:
                        - message: filepath.mode is immutable
                          rule: self == oldSelf
                  type: object
                initWorkloads:
                  default: {}
                  description: InitWorkloads controls whether Kratix writes initial placeholder files to the StateStore for this Destination
                  properties:
                    enabled:
                      default: true
                      description: When true, Kratix will write initial directory structure to the StateStore on Destination creation
                      type: boolean
                  type: object
                path:
                  description: |-
                    Path within StateStore to write documents, this will be appended to any
                    specficed Spec.Path provided in the referenced StateStore.
                    The Path structure will be:
                      <StateStore.Spec.Path>/<Destination.Spec.Path>/
                    Kratix may create other subdirectories, depending on the Filepath.mode you select.
                    To write to the root of the StateStore.Spec.Path, set Path to "." or "/".
                    Defaults to the Destination name
                  type: string
                stateStoreRef:
                  description: Reference to the StateStore (GitStateStore or BucketStateStore) used to persist resources for this Destination
                  properties:
                    kind:
                      description: Kind of the StateStore resource. Must be either BucketStateStore or GitStateStore
                      enum:
                        - BucketStateStore
                        - GitStateStore
                      type: string
                    name:
                      description: Name of the StateStore resource
                      type: string
                  required:
                    - kind
                    - name
                  type: object
                strictMatchLabels:
                  description: |-
                    By default, Kratix will schedule works without labels to all destinations
                    (for promise dependencies) or to a random destination (for resource
                    requests). If StrictMatchLabels is true, Kratix will only schedule works
                    to this destination if it can be selected by the Promise's
                    destinationSelectors. An empty label set on the work won't be scheduled
                    to this destination, unless the destination label set is also empty
                  type: boolean
              required:
                - path
              type: object
            status:
              description: DestinationStatus defines the observed state of Destination
              properties:
                conditions:
                  description: Current conditions of the Destination. Includes a Ready condition indicating whether the StateStore is accessible
                  items:
                    description: Condition contains details for one aspect of the current state of this API Resource.
                    properties:
                      lastTransitionTime:
                        description: |-
                          lastTransitionTime is the last time the condition transitioned from one status to another.
                          This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                        format: date-time
                        type: string
                      message:
                        description: |-
                          message is a human readable message indicating details about the transition.
                          This may be an empty string.
                        maxLength: 32768
                        type: string
                      observedGeneration:
                        description: |-
                          observedGeneration represents the .metadata.generation that the condition was set based upon.
                          For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                          with respect to the current state of the instance.
                        format: int64
                        minimum: 0
                        type: integer
                      reason:
                        description: |-
                          reason contains a programmatic identifier indicating the reason for the condition's last transition.
                          Producers of specific condition types may define expected values and meanings for this field,
                          and whether the values are considered a guaranteed API.
                          The value should be a CamelCase string.
                          This field may not be empty.
                        maxLength: 1024
                        minLength: 1
                        pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                        type: string
                      status:
                        description: status of the condition, one of True, False, Unknown.
                        enum:
                          - "True"
                          - "False"
                          - Unknown
                        type: string
                      type:
                        description: type of condition in CamelCase or in foo.example.com/CamelCase.
                        maxLength: 316
                        pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                        type: string
                    required:
                      - lastTransitionTime
                      - message
                      - reason
                      - status
                      - type
                    type: object
                  type: array
              type: object
          type: object
      served: true
      storage: true
      subresources:
        status: {}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.16.5
  labels:
    app.kubernetes.io/component: kratix-manager
    app.kubernetes.io/instance: kratix-platform
    app.kubernetes.io/part-of: kratix
  name: gitstatestores.platform.kratix.io
spec:
  group: platform.kratix.io
  names:
    categories:
      - kratix
    kind: GitStateStore
    listKind: GitStateStoreList
    plural: gitstatestores
    singular: gitstatestore
  scope: Cluster
  versions:
    - additionalPrinterColumns:
        - description: Indicates the state store is ready to use
          jsonPath: .status.conditions[?(@.type=="Ready")].status
          name: Ready
          type: string
      name: v1alpha1
      schema:
        openAPIV3Schema:
          description: GitStateStore is the Schema for the gitstatestores API
          properties:
            apiVersion:
              description: |-
                APIVersion defines the versioned schema of this representation of an object.
                Servers should convert recognized schemas to the latest internal value, and
                may reject unrecognized values.
                More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
              type: string
            kind:
              description: |-
                Kind is a string value representing the REST resource this object represents.
                Servers may infer this from the endpoint the client submits requests to.
                Cannot be updated.
                In CamelCase.
                More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
              type: string
            metadata:
              type: object
            spec:
              description: GitStateStoreSpec defines the desired state of GitStateStore
              properties:
                authMethod:
                  default: basicAuth
                  description: |-
                    Authentication method used to access the StateStore.
                    Default to basicAuth; options are basicAuth, ssh, and githubApp.
                  enum:
                    - basicAuth
                    - ssh
                    - githubApp
                  type: string
                branch:
                  default: main
                  description: Branch of the git repository; default to main.
                  type: string
                gitAuthor:
                  default:
                    name: kratix
                  description: Git author name and email used to commit this git state store; name defaults to 'kratix'
                  properties:
                    email:
                      description: Email of the Git commit author
                      type: string
                    name:
                      description: Name of the Git commit author
                      type: string
                  type: object
                path:
                  description: |-
                    Path within the StateStore to write documents. This path should be allocated
                    to Kratix as it will create, update, and delete files within this path.
                    Path structure begins with provided path and ends with namespaced destination name:
                      <StateStore.Spec.Path>/<Destination.Spec.Path>/<Destination.Metadata.Namespace>/<Destination.Metadata.Name>/
                  type: string
                secretRef:
                  description: SecretRef specifies the Secret containing authentication credentials
                  properties:
                    name:
                      description: name is unique within a namespace to reference a secret resource.
                      type: string
                    namespace:
                      description: namespace defines the space within which the secret name must be unique.
                      type: string
                  type: object
                  x-kubernetes-map-type: atomic
                url:
                  description: URL of the git repository.
                  type: string
              type: object
            status:
              description: StateStoreStatus defines the observed state of a state store
              properties:
                conditions:
                  description: Current conditions of the StateStore. Includes a Ready condition indicating whether Kratix can access the store
                  items:
                    description: Condition contains details for one aspect of the current state of this API Resource.
                    properties:
                      lastTransitionTime:
                        description: |-
                          lastTransitionTime is the last time the condition transitioned from one status to another.
                          This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                        format: date-time
                        type: string
                      message:
                        description: |-
                          message is a human readable message indicating details about the transition.
                          This may be an empty string.
                        maxLength: 32768
                        type: string
                      observedGeneration:
                        description: |-
                          observedGeneration represents the .metadata.generation that the condition was set based upon.
                          For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                          with respect to the current state of the instance.
                        format: int64
                        minimum: 0
                        type: integer
                      reason:
                        description: |-
                          reason contains a programmatic identifier indicating the reason for the condition's last transition.
                          Producers of specific condition types may define expected values and meanings for this field,
                          and whether the values are considered a guaranteed API.
                          The value should be a CamelCase string.
                          This field may not be empty.
                        maxLength: 1024
                        minLength: 1
                        pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                        type: string
                      status:
                        description: status of the condition, one of True, False, Unknown.
                        enum:
                          - "True"
                          - "False"
                          - Unknown
                        type: string
                      type:
                        description: type of condition in CamelCase or in foo.example.com/CamelCase.
                        maxLength: 316
                        pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                        type: string
                    required:
                      - lastTransitionTime
                      - message
                      - reason
                      - status
                      - type
                    type: object
                  type: array
                status:
                  description: Overall status of the StateStore
                  type: string
              required:
                - status
              type: object
          type: object
      served: true
      storage: true
      subresources:
        status: {}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.16.5
  labels:
    app.kubernetes.io/component: kratix-manager
    app.kubernetes.io/instance: kratix-platform
    app.kubernetes.io/part-of: kratix
  name: healthrecords.platform.kratix.io
spec:
  group: platform.kratix.io
  names:
    kind: HealthRecord
    listKind: HealthRecordList
    plural: healthrecords
    singular: healthrecord
  scope: Namespaced
  versions:
    - additionalPrinterColumns:
        - description: Shows the HealthRecord state
          jsonPath: .data.state
          name: Status
          type: string
        - description: When was the HealthRecord created
          jsonPath: .metadata.creationTimestamp
          name: Age
          type: date
      name: v1alpha1
      schema:
        openAPIV3Schema:
          description: HealthRecord is the Schema for the healthrecords API
          properties:
            apiVersion:
              description: |-
                APIVersion defines the versioned schema of this representation of an object.
                Servers should convert recognized schemas to the latest internal value, and
                may reject unrecognized values.
                More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
              type: string
            data:
              description: HealthRecordData defines the desired state of HealthRecord
              properties:
                details:
                  description: Arbitrary JSON details from the healthcheck pipeline
                  type: object
                  x-kubernetes-preserve-unknown-fields: true
                lastRun:
                  description: Unix timestamp of the last healthcheck run
                  format: int64
                  type: integer
                promiseRef:
                  description: Reference to the Promise this health record belongs to
                  properties:
                    name:
                      description: Name of the referenced Promise
                      type: string
                  required:
                    - name
                  type: object
                resourceRef:
                  description: Reference to the Resource Request this health record belongs to. Required when the HealthRecord is for a resource request
                  properties:
                    generation:
                      description: Generation of the Resource Request at the time of recording
                      type: integer
                    name:
                      description: Name of the Resource Request
                      type: string
                    namespace:
                      description: Namespace of the Resource Request
                      type: string
                  required:
                    - name
                    - namespace
                  type: object
                state:
                  default: unknown
                  description: Health state of the resource; one of unknown, ready, unhealthy, healthy, or degraded
                  enum:
                    - unknown
                    - ready
                    - unhealthy
                    - healthy
                    - degraded
                  type: string
              required:
                - promiseRef
                - state
              type: object
            kind:
              description: |-
                Kind is a string value representing the REST resource this object represents.
                Servers may infer this from the endpoint the client submits requests to.
                Cannot be updated.
                In CamelCase.
                More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
              type: string
            metadata:
              type: object
          type: object
      served: true
      storage: true
      subresources: {}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.16.5
  labels:
    app.kubernetes.io/component: kratix-manager
    app.kubernetes.io/instance: kratix-platform
    app.kubernetes.io/part-of: kratix
  name: promisereleases.platform.kratix.io
spec:
  group: platform.kratix.io
  names:
    categories:
      - kratix
    kind: PromiseRelease
    listKind: PromiseReleaseList
    plural: promisereleases
    singular: promiserelease
  scope: Cluster
  versions:
    - additionalPrinterColumns:
        - jsonPath: .status.status
          name: Status
          type: string
        - jsonPath: .spec.version
          name: Version
          type: string
      name: v1alpha1
      schema:
        openAPIV3Schema:
          description: PromiseRelease is the Schema for the promisereleases API
          properties:
            apiVersion:
              description: |-
                APIVersion defines the versioned schema of this representation of an object.
                Servers should convert recognized schemas to the latest internal value, and
                may reject unrecognized values.
                More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
              type: string
            kind:
              description: |-
                Kind is a string value representing the REST resource this object represents.
                Servers may infer this from the endpoint the client submits requests to.
                Cannot be updated.
                In CamelCase.
                More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
              type: string
            metadata:
              type: object
            spec:
              description: PromiseReleaseSpec defines the desired state of PromiseRelease
              properties:
                sourceRef:
                  default:
                    type: http
                  description: Reference to the source from which the Promise will be fetched
                  properties:
                    secretRef:
                      description: |-
                        Reference a secret with credentials to access the source.
                        For more details on the secret format, see the documentation:
                          https://docs.kratix.io/main/reference/promises/releases#promise-release
                      properties:
                        name:
                          description: name is unique within a namespace to reference a secret resource.
                          type: string
                        namespace:
                          description: namespace defines the space within which the secret name must be unique.
                          type: string
                      type: object
                      x-kubernetes-map-type: atomic
                    type:
                      description: Type of the source; currently only "http" is supported
                      enum:
                        - http
                      type: string
                    url:
                      description: URL from which to fetch the Promise definition
                      type: string
                  required:
                    - type
                  type: object
                version:
                  description: Version of the Promise to install
                  type: string
              required:
                - sourceRef
              type: object
            status:
              description: PromiseReleaseStatus defines the observed state of PromiseRelease
              properties:
                conditions:
                  description: Current conditions of the PromiseRelease
                  items:
                    description: Condition contains details for one aspect of the current state of this API Resource.
                    properties:
                      lastTransitionTime:
                        description: |-
                          lastTransitionTime is the last time the condition transitioned from one status to another.
                          This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                        format: date-time
                        type: string
                      message:
                        description: |-
                          message is a human readable message indicating details about the transition.
                          This may be an empty string.
                        maxLength: 32768
                        type: string
                      observedGeneration:
                        description: |-
                          observedGeneration represents the .metadata.generation that the condition was set based upon.
                          For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                          with respect to the current state of the instance.
                        format: int64
                        minimum: 0
                        type: integer
                      reason:
                        description: |-
                          reason contains a programmatic identifier indicating the reason for the condition's last transition.
                          Producers of specific condition types may define expected values and meanings for this field,
                          and whether the values are considered a guaranteed API.
                          The value should be a CamelCase string.
                          This field may not be empty.
                        maxLength: 1024
                        minLength: 1
                        pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                        type: string
                      status:
                        description: status of the condition, one of True, False, Unknown.
                        enum:
                          - "True"
                          - "False"
                          - Unknown
                        type: string
                      type:
                        description: type of condition in CamelCase or in foo.example.com/CamelCase.
                        maxLength: 316
                        pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                        type: string
                    required:
                      - lastTransitionTime
                      - message
                      - reason
                      - status
                      - type
                    type: object
                  type: array
                status:
                  description: Overall status of the PromiseRelease (e.g. Installed, Failed)
                  type: string
              type: object
          type: object
      served: true
      storage: true
      subresources:
        status: {}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.16.5
  labels:
    app.kubernetes.io/component: kratix-manager
    app.kubernetes.io/instance: kratix-platform
    app.kubernetes.io/part-of: kratix
  name: promiserevisions.platform.kratix.io
spec:
  group: platform.kratix.io
  names:
    categories:
      - kratix
    kind: PromiseRevision
    listKind: PromiseRevisionList
    plural: promiserevisions
    singular: promiserevision
  scope: Cluster
  versions:
    - additionalPrinterColumns:
        - description: Indicates if this PromiseRevision is the latest.
          jsonPath: .status.latest
          name: Latest
          type: boolean
      name: v1alpha1
      schema:
        openAPIV3Schema:
          description: PromiseRevision is the Schema for the promiserevisions API
          properties:
            apiVersion:
              description: |-
                APIVersion defines the versioned schema of this representation of an object.
                Servers should convert recognized schemas to the latest internal value, and
                may reject unrecognized values.
                More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
              type: string
            kind:
              description: |-
                Kind is a string value representing the REST resource this object represents.
                Servers may infer this from the endpoint the client submits requests to.
                Cannot be updated.
                In CamelCase.
                More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
              type: string
            metadata:
              type: object
            spec:
              description: spec defines the desired state of PromiseRevision
              properties:
                promiseRef:
                  description: PromiseRef is the reference to the Promise this revision is based on.
                  properties:
                    name:
                      description: Name of the referenced Promise
                      type: string
                  required:
                    - name
                  type: object
                promiseSpec:
                  description: PromiseSpec is the Spec of the Promise this revision is based on.
                  properties:
                    api:
                      description: |-
                        API an application developers will use to request a Resource from this Promise.
                        Must be a valid kubernetes custom resource definition.
                      type: object
                      x-kubernetes-embedded-resource: true
                      x-kubernetes-preserve-unknown-fields: true
                    dependencies:
                      description: A collection of prerequisites that enable the creation of a Resource.
                      items:
                        description: Resources represents the manifest workload to be deployed on Destinations
                        type: object
                        x-kubernetes-preserve-unknown-fields: true
                      type: array
                    destinationSelectors:
                      description: A list of key and value pairs (labels) used for scheduling.
                      items:
                        description: PromiseScheduling defines label selectors for matching Destinations where Resources should be scheduled
                        properties:
                          matchLabels:
                            additionalProperties:
                              type: string
                            description: Labels that a Destination must match for Resources from this Promise to be scheduled to it
                            type: object
                        type: object
                      type: array
                    requiredPromises:
                      description: |-
                        A list of Promises that are required by this Promise.
                        All required Promises must be present and available for this promise to be made available.
                      items:
                        description: RequiredPromise defines a dependency on another Promise that must be installed and available
                        properties:
                          name:
                            description: Name of the required Promise
                            type: string
                          version:
                            description: Version of the required Promise. If empty, any version is accepted
                            type: string
                        type: object
                      type: array
                    workflows:
                      description: A list of pipelines to be executed at different stages of the Promise lifecycle.
                      properties:
                        config:
                          description: Configuration options that apply to all workflows defined in this Promise
                          properties:
                            pipelineNamespace:
                              description: Namespace for all workflow jobs (promise and resource) to run in; needs to be an existing namespace or else workflow won't start
                              type: string
                          type: object
                        promise:
                          description: Pipelines triggered when the Promise itself is created, updated, or deleted
                          properties:
                            configure:
                              description: Pipelines to execute when the resource or Promise is created or updated
                              items:
                                type: object
                              type: array
                              x-kubernetes-preserve-unknown-fields: true
                            delete:
                              description: Pipelines to execute when the resource or Promise is deleted
                              items:
                                type: object
                              type: array
                              x-kubernetes-preserve-unknown-fields: true
                          type: object
                        resource:
                          description: Pipelines triggered when a Resource Request (instance of the Promise API) is created, updated, or deleted
                          properties:
                            configure:
                              description: Pipelines to execute when the resource or Promise is created or updated
                              items:
                                type: object
                              type: array
                              x-kubernetes-preserve-unknown-fields: true
                            delete:
                              description: Pipelines to execute when the resource or Promise is deleted
                              items:
                                type: object
                              type: array
                              x-kubernetes-preserve-unknown-fields: true
                          type: object
                      type: object
                  type: object
                version:
                  description: Version is the version of the Promise this revision is based on.
                  type: string
              required:
                - promiseRef
                - promiseSpec
                - version
              type: object
            status:
              description: status defines the observed state of PromiseRevision
              properties:
                conditions:
                  items:
                    description: Condition contains details for one aspect of the current state of this API Resource.
                    properties:
                      lastTransitionTime:
                        description: |-
                          lastTransitionTime is the last time the condition transitioned from one status to another.
                          This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                        format: date-time
                        type: string
                      message:
                        description: |-
                          message is a human readable message indicating details about the transition.
                          This may be an empty string.
                        maxLength: 32768
                        type: string
                      observedGeneration:
                        description: |-
                          observedGeneration represents the .metadata.generation that the condition was set based upon.
                          For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                          with respect to the current state of the instance.
                        format: int64
                        minimum: 0
                        type: integer
                      reason:
                        description: |-
                          reason contains a programmatic identifier indicating the reason for the condition's last transition.
                          Producers of specific condition types may define expected values and meanings for this field,
                          and whether the values are considered a guaranteed API.
                          The value should be a CamelCase string.
                          This field may not be empty.
                        maxLength: 1024
                        minLength: 1
                        pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                        type: string
                      status:
                        description: status of the condition, one of True, False, Unknown.
                        enum:
                          - "True"
                          - "False"
                          - Unknown
                        type: string
                      type:
                        description: type of condition in CamelCase or in foo.example.com/CamelCase.
                        maxLength: 316
                        pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                        type: string
                    required:
                      - lastTransitionTime
                      - message
                      - reason
                      - status
                      - type
                    type: object
                  type: array
                  x-kubernetes-list-map-keys:
                    - type
                  x-kubernetes-list-type: map
                latest:
                  description: Latest is true if this revision is the latest revision for the Promise. Only one revision can be the latest at a time.
                  type: boolean
              type: object
          required:
            - spec
          type: object
      served: true
      storage: true
      subresources:
        status: {}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    cert-manager.io/inject-ca-from: kratix-platform-system/kratix-platform-serving-cert
    controller-gen.kubebuilder.io/version: v0.16.5
  labels:
    app.kubernetes.io/component: kratix-manager
    app.kubernetes.io/instance: kratix-platform
    app.kubernetes.io/part-of: kratix
  name: promises.platform.kratix.io
spec:
  conversion:
    strategy: Webhook
    webhook:
      clientConfig:
        service:
          name: kratix-platform-webhook-service
          namespace: kratix-platform-system
          path: /convert
      conversionReviewVersions:
        - v1alpha1
        - v1beta1
  group: platform.kratix.io
  names:
    categories:
      - kratix
    kind: Promise
    listKind: PromiseList
    plural: promises
    singular: promise
  scope: Cluster
  versions:
    - additionalPrinterColumns:
        - jsonPath: .status.status
          name: Status
          type: string
        - jsonPath: .status.kind
          name: Kind
          type: string
        - jsonPath: .status.apiVersion
          name: API Version
          type: string
        - jsonPath: .status.version
          name: Version
          type: string
      name: v1alpha1
      schema:
        openAPIV3Schema:
          description: Promise is the Schema for the promises API
          properties:
            apiVersion:
              description: |-
                APIVersion defines the versioned schema of this representation of an object.
                Servers should convert recognized schemas to the latest internal value, and
                may reject unrecognized values.
                More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
              type: string
            kind:
              description: |-
                Kind is a string value representing the REST resource this object represents.
                Servers may infer this from the endpoint the client submits requests to.
                Cannot be updated.
                In CamelCase.
                More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
              type: string
            metadata:
              type: object
            spec:
              description: PromiseSpec defines the desired state of Promise
              properties:
                api:
                  description: |-
                    API an application developers will use to request a Resource from this Promise.
                    Must be a valid kubernetes custom resource definition.
                  type: object
                  x-kubernetes-embedded-resource: true
                  x-kubernetes-preserve-unknown-fields: true
                dependencies:
                  description: A collection of prerequisites that enable the creation of a Resource.
                  items:
                    description: Resources represents the manifest workload to be deployed on Destinations
                    type: object
                    x-kubernetes-preserve-unknown-fields: true
                  type: array
                destinationSelectors:
                  description: A list of key and value pairs (labels) used for scheduling.
                  items:
                    description: PromiseScheduling defines label selectors for matching Destinations where Resources should be scheduled
                    properties:
                      matchLabels:
                        additionalProperties:
                          type: string
                        description: Labels that a Destination must match for Resources from this Promise to be scheduled to it
                        type: object
                    type: object
                  type: array
                requiredPromises:
                  description: |-
                    A list of Promises that are required by this Promise.
                    All required Promises must be present and available for this promise to be made available.
                  items:
                    description: RequiredPromise defines a dependency on another Promise that must be installed and available
                    properties:
                      name:
                        description: Name of the required Promise
                        type: string
                      version:
                        description: Version of the required Promise. If empty, any version is accepted
                        type: string
                    type: object
                  type: array
                workflows:
                  description: A list of pipelines to be executed at different stages of the Promise lifecycle.
                  properties:
                    config:
                      description: Configuration options that apply to all workflows defined in this Promise
                      properties:
                        pipelineNamespace:
                          description: Namespace for all workflow jobs (promise and resource) to run in; needs to be an existing namespace or else workflow won't start
                          type: string
                      type: object
                    promise:
                      description: Pipelines triggered when the Promise itself is created, updated, or deleted
                      properties:
                        configure:
                          description: Pipelines to execute when the resource or Promise is created or updated
                          items:
                            type: object
                          type: array
                          x-kubernetes-preserve-unknown-fields: true
                        delete:
                          description: Pipelines to execute when the resource or Promise is deleted
                          items:
                            type: object
                          type: array
                          x-kubernetes-preserve-unknown-fields: true
                      type: object
                    resource:
                      description: Pipelines triggered when a Resource Request (instance of the Promise API) is created, updated, or deleted
                      properties:
                        configure:
                          description: Pipelines to execute when the resource or Promise is created or updated
                          items:
                            type: object
                          type: array
                          x-kubernetes-preserve-unknown-fields: true
                        delete:
                          description: Pipelines to execute when the resource or Promise is deleted
                          items:
                            type: object
                          type: array
                          x-kubernetes-preserve-unknown-fields: true
                      type: object
                  type: object
              type: object
            status:
              description: PromiseStatus defines the observed state of Promise
              properties:
                apiVersion:
                  description: The API version of the Resource API defined by this Promise (e.g. "marketplace.kratix.io/v1alpha1")
                  type: string
                conditions:
                  description: Current conditions of the Promise. Includes Available, WorksSucceeded, and Reconciled conditions
                  items:
                    description: Condition contains details for one aspect of the current state of this API Resource.
                    properties:
                      lastTransitionTime:
                        description: |-
                          lastTransitionTime is the last time the condition transitioned from one status to another.
                          This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                        format: date-time
                        type: string
                      message:
                        description: |-
                          message is a human readable message indicating details about the transition.
                          This may be an empty string.
                        maxLength: 32768
                        type: string
                      observedGeneration:
                        description: |-
                          observedGeneration represents the .metadata.generation that the condition was set based upon.
                          For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                          with respect to the current state of the instance.
                        format: int64
                        minimum: 0
                        type: integer
                      reason:
                        description: |-
                          reason contains a programmatic identifier indicating the reason for the condition's last transition.
                          Producers of specific condition types may define expected values and meanings for this field,
                          and whether the values are considered a guaranteed API.
                          The value should be a CamelCase string.
                          This field may not be empty.
                        maxLength: 1024
                        minLength: 1
                        pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                        type: string
                      status:
                        description: status of the condition, one of True, False, Unknown.
                        enum:
                          - "True"
                          - "False"
                          - Unknown
                        type: string
                      type:
                        description: type of condition in CamelCase or in foo.example.com/CamelCase.
                        maxLength: 316
                        pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                        type: string
                    required:
                      - lastTransitionTime
                      - message
                      - reason
                      - status
                      - type
                    type: object
                  type: array
                kind:
                  description: The Kind of the Resource API defined by this Promise (e.g. "Database")
                  type: string
                lastAvailableTime:
                  description: Timestamp of when this Promise was last in an Available state
                  format: date-time
                  type: string
                observedGeneration:
                  description: The generation last observed by the controller
                  format: int64
                  type: integer
                requiredBy:
                  description: List of other Promises that depend on this Promise
                  items:
                    description: RequiredBy indicates another Promise depends on this one
                    properties:
                      promise:
                        description: The Promise that requires this Promise
                        properties:
                          name:
                            description: Name of the Promise
                            type: string
                          version:
                            description: Version of the Promise
                            type: string
                        type: object
                      requiredVersion:
                        description: The specific version required by the dependent Promise
                        type: string
                    type: object
                  type: array
                requiredPromises:
                  description: Status of each required Promise dependency
                  items:
                    description: RequiredPromiseStatus tracks the availability of a required Promise dependency
                    properties:
                      name:
                        description: Name of the required Promise
                        type: string
                      state:
                        description: Current state of the required Promise (e.g. "Available", "Unavailable")
                        type: string
                      version:
                        description: Installed version of the required Promise
                        type: string
                    type: object
                  type: array
                status:
                  description: 'Overall status of the Promise: Available or Unavailable'
                  type: string
                version:
                  description: Version of the Promise, derived from the PromiseRelease if installed via one
                  type: string
                workflows:
                  description: Total number of Promise-level workflow pipelines
                  format: int64
                  type: integer
                workflowsFailed:
                  description: Number of Promise-level workflow pipelines that have failed
                  format: int64
                  type: integer
                workflowsSucceeded:
                  description: Number of Promise-level workflow pipelines that have completed successfully
                  format: int64
                  type: integer
              required:
                - workflows
                - workflowsFailed
                - workflowsSucceeded
              type: object
          type: object
      served: true
      storage: true
      subresources:
        status: {}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.16.5
  labels:
    app.kubernetes.io/component: kratix-manager
    app.kubernetes.io/instance: kratix-platform
    app.kubernetes.io/part-of: kratix
  name: resourcebindings.platform.kratix.io
spec:
  group: platform.kratix.io
  names:
    kind: ResourceBinding
    listKind: ResourceBindingList
    plural: resourcebindings
    singular: resourcebinding
  scope: Namespaced
  versions:
    - additionalPrinterColumns:
        - description: Resource using a Promise
          jsonPath: .spec.resourceRef.name
          name: Resource
          type: string
        - description: Promise being used by the Resource
          jsonPath: .spec.promiseRef.name
          name: Promise
          type: string
        - description: Promise version used by the Resource
          jsonPath: .spec.version
          name: Version
          type: string
      name: v1alpha1
      schema:
        openAPIV3Schema:
          description: ResourceBinding is the Schema for the resourcebindings API
          properties:
            apiVersion:
              description: |-
                APIVersion defines the versioned schema of this representation of an object.
                Servers should convert recognized schemas to the latest internal value, and
                may reject unrecognized values.
                More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
              type: string
            kind:
              description: |-
                Kind is a string value representing the REST resource this object represents.
                Servers may infer this from the endpoint the client submits requests to.
                Cannot be updated.
                In CamelCase.
                More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
              type: string
            metadata:
              type: object
            spec:
              description: spec defines the desired state of ResourceBinding
              properties:
                promiseRef:
                  description: Reference to the Promise that this binding tracks
                  properties:
                    name:
                      description: Name of the referenced Promise
                      type: string
                  required:
                    - name
                  type: object
                resourceRef:
                  description: Reference to the Resource Request that this binding tracks
                  properties:
                    generation:
                      description: Generation of the Resource Request at the time of recording
                      type: integer
                    name:
                      description: Name of the Resource Request
                      type: string
                    namespace:
                      description: Namespace of the Resource Request
                      type: string
                  required:
                    - name
                    - namespace
                  type: object
                version:
                  description: Version is the version of the Promise that this ResourceRequest was last reconciled with.
                  type: string
              required:
                - promiseRef
                - resourceRef
                - version
              type: object
            status:
              description: status defines the observed state of ResourceBinding
              properties:
                conditions:
                  description: The status of each condition is one of True, False, or Unknown.
                  items:
                    description: Condition contains details for one aspect of the current state of this API Resource.
                    properties:
                      lastTransitionTime:
                        description: |-
                          lastTransitionTime is the last time the condition transitioned from one status to another.
                          This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                        format: date-time
                        type: string
                      message:
                        description: |-
                          message is a human readable message indicating details about the transition.
                          This may be an empty string.
                        maxLength: 32768
                        type: string
                      observedGeneration:
                        description: |-
                          observedGeneration represents the .metadata.generation that the condition was set based upon.
                          For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                          with respect to the current state of the instance.
                        format: int64
                        minimum: 0
                        type: integer
                      reason:
                        description: |-
                          reason contains a programmatic identifier indicating the reason for the condition's last transition.
                          Producers of specific condition types may define expected values and meanings for this field,
                          and whether the values are considered a guaranteed API.
                          The value should be a CamelCase string.
                          This field may not be empty.
                        maxLength: 1024
                        minLength: 1
                        pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                        type: string
                      status:
                        description: status of the condition, one of True, False, Unknown.
                        enum:
                          - "True"
                          - "False"
                          - Unknown
                        type: string
                      type:
                        description: type of condition in CamelCase or in foo.example.com/CamelCase.
                        maxLength: 316
                        pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                        type: string
                    required:
                      - lastTransitionTime
                      - message
                      - reason
                      - status
                      - type
                    type: object
                  type: array
                  x-kubernetes-list-map-keys:
                    - type
                  x-kubernetes-list-type: map
              type: object
          required:
            - spec
          type: object
      selectableFields:
        - jsonPath: .spec.version
      served: true
      storage: true
      subresources:
        status: {}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.16.5
  labels:
    app.kubernetes.io/component: kratix-manager
    app.kubernetes.io/instance: kratix-platform
    app.kubernetes.io/part-of: kratix
  name: workplacements.platform.kratix.io
spec:
  group: platform.kratix.io
  names:
    categories:
      - kratix
    kind: WorkPlacement
    listKind: WorkPlacementList
    plural: workplacements
    shortNames:
      - wp
      - wps
    singular: workplacement
  scope: Namespaced
  versions:
    - additionalPrinterColumns:
        - description: Destination this Workplacement is scheduled to.
          jsonPath: .spec.targetDestinationName
          name: DESTINATION
          type: string
        - description: Status of this Workplacement
          jsonPath: .status.conditions[?(@.type=="Ready")].message
          name: STATUS
          type: string
      name: v1alpha1
      schema:
        openAPIV3Schema:
          description: WorkPlacement is the Schema for the workplacements API
          properties:
            apiVersion:
              description: |-
                APIVersion defines the versioned schema of this representation of an object.
                Servers should convert recognized schemas to the latest internal value, and
                may reject unrecognized values.
                More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
              type: string
            kind:
              description: |-
                Kind is a string value representing the REST resource this object represents.
                Servers may infer this from the endpoint the client submits requests to.
                Cannot be updated.
                In CamelCase.
                More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
              type: string
            metadata:
              type: object
            spec:
              description: WorkPlacementSpec defines the desired state of WorkPlacement
              properties:
                id:
                  description: Unique identifier for the workload group this WorkPlacement represents
                  type: string
                promiseName:
                  description: Name of the Promise that generated the parent Work
                  type: string
                resourceName:
                  description: Name of the Resource Request that generated the parent Work. Empty for Promise-level dependencies
                  type: string
                targetDestinationName:
                  description: Name of the Destination this WorkPlacement is assigned to
                  type: string
                workloads:
                  description: List of workloads to be written to the target Destination's StateStore
                  items:
                    description: Workload represents a single manifest file to be written to a Destination StateStore
                    properties:
                      content:
                        description: Content of the workload manifest, base64 encoded and gzip compressed
                        type: string
                      filepath:
                        description: Path of the file relative to the workload group directory
                        type: string
                    type: object
                  type: array
              type: object
            status:
              description: WorkPlacementStatus defines the observed state of WorkPlacement
              properties:
                conditions:
                  description: Current conditions of the WorkPlacement. Includes a Ready condition indicating all workloads are written to the StateStore
                  items:
                    description: Condition contains details for one aspect of the current state of this API Resource.
                    properties:
                      lastTransitionTime:
                        description: |-
                          lastTransitionTime is the last time the condition transitioned from one status to another.
                          This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                        format: date-time
                        type: string
                      message:
                        description: |-
                          message is a human readable message indicating details about the transition.
                          This may be an empty string.
                        maxLength: 32768
                        type: string
                      observedGeneration:
                        description: |-
                          observedGeneration represents the .metadata.generation that the condition was set based upon.
                          For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                          with respect to the current state of the instance.
                        format: int64
                        minimum: 0
                        type: integer
                      reason:
                        description: |-
                          reason contains a programmatic identifier indicating the reason for the condition's last transition.
                          Producers of specific condition types may define expected values and meanings for this field,
                          and whether the values are considered a guaranteed API.
                          The value should be a CamelCase string.
                          This field may not be empty.
                        maxLength: 1024
                        minLength: 1
                        pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                        type: string
                      status:
                        description: status of the condition, one of True, False, Unknown.
                        enum:
                          - "True"
                          - "False"
                          - Unknown
                        type: string
                      type:
                        description: type of condition in CamelCase or in foo.example.com/CamelCase.
                        maxLength: 316
                        pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                        type: string
                    required:
                      - lastTransitionTime
                      - message
                      - reason
                      - status
                      - type
                    type: object
                  type: array
                versionID:
                  description: |-
                    VersionID contains the version identifier of the last applied workplacement
                    For Git StateStores, this is the SHA of the last applied commit
                    For Bucket StateStores, this is always empty
                  type: string
              type: object
          type: object
      served: true
      storage: true
      subresources:
        status: {}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.16.5
  labels:
    app.kubernetes.io/component: kratix-manager
    app.kubernetes.io/instance: kratix-platform
    app.kubernetes.io/part-of: kratix
  name: works.platform.kratix.io
spec:
  group: platform.kratix.io
  names:
    categories:
      - kratix
    kind: Work
    listKind: WorkList
    plural: works
    singular: work
  scope: Namespaced
  versions:
    - additionalPrinterColumns:
        - description: Status of this Work.
          jsonPath: .status.conditions[?(@.type=="Ready")].message
          name: STATUS
          type: string
      name: v1alpha1
      schema:
        openAPIV3Schema:
          description: Work is the Schema for the works API
          properties:
            apiVersion:
              description: |-
                APIVersion defines the versioned schema of this representation of an object.
                Servers should convert recognized schemas to the latest internal value, and
                may reject unrecognized values.
                More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
              type: string
            kind:
              description: |-
                Kind is a string value representing the REST resource this object represents.
                Servers may infer this from the endpoint the client submits requests to.
                Cannot be updated.
                In CamelCase.
                More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
              type: string
            metadata:
              type: object
            spec:
              description: WorkSpec defines the desired state of Work
              properties:
                promiseName:
                  description: Name of the Promise that generated this Work
                  type: string
                resourceName:
                  description: Name of the Resource Request that generated this Work. Empty for Promise-level dependencies
                  type: string
                workloadGroups:
                  description: Groups of workloads to be scheduled to Destinations. Each group can target different Destinations via label selectors
                  items:
                    description: |-
                      WorkloadGroup represents a set of workloads in a particular directory that should
                      be scheduled to a Destination.
                    properties:
                      destinationSelectors:
                        description: Label selectors used to determine which Destinations should receive this workload group
                        items:
                          description: WorkloadGroupScheduling defines label-based scheduling for a workload group
                          properties:
                            matchLabels:
                              additionalProperties:
                                type: string
                              description: Labels that a Destination must match to receive this workload group
                              type: object
                            source:
                              description: Origin of these selectors (e.g. "promise" or "resource")
                              type: string
                          type: object
                        type: array
                      directory:
                        description: Directory within the pipeline output where these workloads originated
                        type: string
                      id:
                        description: Unique identifier for this workload group, derived from a hash of the directory
                        type: string
                      workloads:
                        description: List of workloads to be written to the Destination StateStore
                        items:
                          description: Workload represents a single manifest file to be written to a Destination StateStore
                          properties:
                            content:
                              description: Content of the workload manifest, base64 encoded and gzip compressed
                              type: string
                            filepath:
                              description: Path of the file relative to the workload group directory
                              type: string
                          type: object
                        type: array
                    type: object
                  type: array
              type: object
            status:
              description: WorkStatus defines the observed state of Work
              properties:
                conditions:
                  description: Current conditions of the Work. Includes a Ready condition indicating all WorkPlacements are written successfully
                  items:
                    description: Condition contains details for one aspect of the current state of this API Resource.
                    properties:
                      lastTransitionTime:
                        description: |-
                          lastTransitionTime is the last time the condition transitioned from one status to another.
                          This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                        format: date-time
                        type: string
                      message:
                        description: |-
                          message is a human readable message indicating details about the transition.
                          This may be an empty string.
                        maxLength: 32768
                        type: string
                      observedGeneration:
                        description: |-
                          observedGeneration represents the .metadata.generation that the condition was set based upon.
                          For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                          with respect to the current state of the instance.
                        format: int64
                        minimum: 0
                        type: integer
                      reason:
                        description: |-
                          reason contains a programmatic identifier indicating the reason for the condition's last transition.
                          Producers of specific condition types may define expected values and meanings for this field,
                          and whether the values are considered a guaranteed API.
                          The value should be a CamelCase string.
                          This field may not be empty.
                        maxLength: 1024
                        minLength: 1
                        pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                        type: string
                      status:
                        description: status of the condition, one of True, False, Unknown.
                        enum:
                          - "True"
                          - "False"
                          - Unknown
                        type: string
                      type:
                        description: type of condition in CamelCase or in foo.example.com/CamelCase.
                        maxLength: 316
                        pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                        type: string
                    required:
                      - lastTransitionTime
                      - message
                      - reason
                      - status
                      - type
                    type: object
                  type: array
                workPlacements:
                  description: Number of WorkPlacements currently scheduled for this Work
                  type: integer
                workPlacementsCreated:
                  description: Total number of WorkPlacements that have been created for this Work
                  type: integer
              type: object
          type: object
      served: true
      storage: true
      subresources:
        status: {}
